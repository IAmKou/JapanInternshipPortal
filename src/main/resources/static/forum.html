<!doctype html>
<html class="no-js" lang="">
<head>
  <meta charset="utf-8">
  <meta content="ie=edge" http-equiv="x-ua-compatible">
  <title>Forum Page</title>
  <meta content="" name="description">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <!-- Favicon -->
  <link href="img/favicon.png" rel="shortcut icon" type="image/x-icon">
  <!-- Normalize CSS -->
  <link href="css/normalize.css" rel="stylesheet">
  <!-- Main CSS -->
  <link href="css/main.css" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <!-- Fontawesome CSS -->
  <link href="css/all.min.css" rel="stylesheet">
  <!-- Flaticon CSS -->
  <link href="fonts/flaticon.css" rel="stylesheet">
  <!-- Full Calender CSS -->
  <link href="css/fullcalendar.min.css" rel="stylesheet">
  <!-- Animate CSS -->
  <link href="css/animate.min.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link href="style.css" rel="stylesheet">
  <!-- Modernize js -->
  <script src="js/modernizr-3.6.0.min.js"></script>
  <style>
    /* Container chính */
    .wrapper {
      display: flex;
      flex-direction: column;
      min-height: 100%; /* Bao phủ toàn bộ trang */
    }

    /* Nội dung bên trên */
    .content {
      flex: 1; /* Đẩy footer xuống */
    }

    /* Footer nằm ở cuối */
    .footer-wrap-layout1 {
      background-color: #ec9006;
      color: white;
      padding: 15px 0;
      text-align: center;
    }

    .footer-wrap-layout1 a {
      color: #ffcc00;
      text-decoration: none;
    }
    .item-title {
      display: flex;
      align-items: center;
    }
    .spacer {
      flex: 1;
    }
    .thread-title a {
      font-size: large;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .dropdown {
      margin-left: auto;
    }
    .thread-thumbnail {
      width: 100px;
      height: 100px;
      background-color: #ccc;
      display: inline-block;
      object-fit: cover;
      margin-right: 15px; /* Thêm khoảng cách giữa ảnh và nội dung */
    }
    .thread-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .thread-content {
      display: inline-block;
      margin-left: 20px;
      vertical-align: top;
      width: calc(100% - 140px);
      box-sizing: border-box;
      padding: 10px; /* Thêm padding bên trong phần nội dung */
      background-color: #fff; /* Màu nền cho phần nội dung */
      border-radius: 5px; /* Làm tròn các góc của phần nội dung */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Thêm bóng cho phần nội dung */
    }
    .thread-title {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 5px;
      word-wrap: break-word;
      text-wrap: wrap;
    }
    .thread-description {
      color: #555;
      margin-bottom: 10px;
      white-space: nowrap;
      text-overflow: ellipsis;
      display: block;
      overflow: hidden;
    }
    .page-btn {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 10px 15px;
      font-size: 16px;
      border-radius: 5px;
      margin: 0 10px;
      cursor: pointer;
    }
    .page-btn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    #pageNumber {
      font-size: 18px;
      font-weight: bold;
    }
    .modal-trigger {
      display: inline-block;
      text-align: center;
      padding-bottom: 30px;
    }
  </style>
</head>
<body>
<!-- Preloader Start Here -->
<div id="preloader"></div>
<!-- Preloader End Here -->
<div class="wrapper bg-ash" id="wrapper">
  <!-- Header Menu Area Start Here -->
  <div id="google_translate_element"></div>

  <div class="navbar navbar-expand-md header-menu-one bg-light">
    <div class="nav-bar-header-one">
      <div class="header-logo">
        <a href="teacher.html">
          <div style="width: 180px; height: 70px; overflow: hidden;">
            <img src="img/JIP%20LOGO%20n.png" alt="logo" style="width: 100%; height: 100%; object-fit: contain;">
          </div>
        </a>
      </div>
      <div class="toggle-button sidebar-toggle">
        <button type="button" class="item-link">
                        <span class="btn-icon-wrap">
                            <span></span>
                            <span></span>
                            <span></span>
                        </span>
        </button>
      </div>
    </div>
    <div class="d-md-none mobile-nav-bar">
      <button class="navbar-toggler pulse-animation" type="button" data-toggle="collapse"
              data-target="#mobile-navbar" aria-expanded="false">
        <i class="far fa-arrow-alt-circle-down"></i>
      </button>
      <button type="button" class="navbar-toggler sidebar-toggle-mobile">
        <i class="fas fa-bars"></i>
      </button>
    </div>
    <div class="header-main-menu collapse navbar-collapse" id="mobile-navbar">
      <ul class="navbar-nav">
        <li class="navbar-item header-search-bar">
          <div class="input-group stylish-input-group">
          </div>
        </li>
      </ul>
      <ul class="navbar-nav">
        <li class="navbar-item dropdown header-admin">
          <a class="navbar-nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown"
             aria-expanded="false">
            <div class="admin-title">
              <h5 class="item-title userFullName"></h5>
              <span class="userRole"></span>
            </div>
            <div class="admin-img img">
              <img src="" style="width: 50px; height: 50px" alt="Admin">
            </div>
          </a>
          <div class="dropdown-menu dropdown-menu-right">
            <div class="item-header">
              <h6 class="item-title userFullName"></h6>
            </div>
            <div class="item-content">
              <ul class="settings-list">
                <li><a href="users-profile-teacher.html"><i class="flaticon-user"></i>My Profile</a></li>
                <li><a href="change-password.html"><i class="flaticon-gear-loading"></i><span data-i18n="change_password">Change Password</span></a></li>
                <li><a href="/logout"><i class="flaticon-turn-off"></i>Log Out</a></li>
              </ul>
            </div>
          </div>
        </li>
        <li class="navbar-item dropdown header-notification">
          <a id="notification-bell" class="navbar-nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-expanded="false">
            <i class="far fa-bell"></i>
            <div class="item-title d-md-none text-16 mg-l-10">Notification</div>
            <span id="notification-count">0</span>
          </a>
          <div class="dropdown-menu dropdown-menu-right" id="notification-dropdown">
            <div class="item-header">
              <h6 class="item-title" id="notification-title">Notifications</h6>
            </div>
            <div class="item-content" id="notification-list">
              <!-- Notifications will be dynamically inserted here -->
            </div>
          </div>
        </li>
        <li class="navbar-item dropdown header-language">
          <a class="navbar-nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-globe-americas"></i> <span id="languageLabel">EN</span>
          </a>
          <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="#" onclick="changeLanguage('en')">
              <img src="img/figure/flag-anh.webp" alt="English" style="width: 20px; height: 15px;"> English
            </a>
            <a class="dropdown-item" href="#" onclick="changeLanguage('ja')">
              <img src="img/figure/Flag_of_Japan.svg.webp" alt="Japanese" style="width: 20px; height: 15px;"> 日本語
            </a>
          </div>
        </li>
      </ul>
    </div>
  </div>
  <!-- Header Menu Area End Here -->
  <!-- Page Area Start Here -->
  <div class="dashboard-page-one">
    <!-- Sidebar Area Start Here -->
    <div class="sidebar-main sidebar-menu-one sidebar-expand-md sidebar-color">
      <div class="mobile-sidebar-header d-md-none">
        <div class="header-logo">
          <a href="teacher.html"><img src="img/logo1.png" alt="logo"></a>
        </div>
      </div>
      <div class="sidebar-menu-content">
        <ul class="nav nav-sidebar-menu sidebar-toggle-view">
          <li class="nav-item sidebar-nav-item">
            <a href="#" class="nav-link"><i class="flaticon-dashboard"></i><span>Dashboard</span></a>
            <ul class="nav sub-group-menu sub-group-active">
              <li class="nav-item">
                <a href="teacher.html" class="nav-link menu-active"><i class="fas fa-angle-right"></i>Teachers</a>
              </li>
            </ul>
          </li>
          <li class="nav-item sidebar-nav-item">
            <a href="#" class="nav-link"><i class="flaticon-books"></i><span>Assignment</span></a>
            <ul class="nav sub-group-menu">
              <li class="nav-item">
                <a href="javascript:void(0);" class="nav-link" onclick="toListAssigment();"><i class="fas fa-angle-right"></i>All
                  Assignment</a>
              </li>
              <li class="nav-item">
                <a href="create-assignment.html" class="nav-link"><i class="fas fa-angle-right"></i>Add New
                  Assignment</a>
              </li>
            </ul>
          </li>

          <li class="nav-item sidebar-nav-item">
            <a href="#" class="nav-link"><i
                    class="flaticon-maths-class-materials-cross-of-a-pencil-and-a-ruler"></i><span>Class</span></a>
            <ul class="nav sub-group-menu">
              <li class="nav-item">
                <a href="javascript:void(0);" class="nav-link" onclick="submitForm();">
                  <i class="flaticon-menu"></i><span>Class List</span>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item sidebar-nav-item">
            <a href="#" class="nav-link"><i class="flaticon-shopping-list"></i><span>Material</span></a>
            <ul class="nav sub-group-menu">
              <li class="nav-item">
                <a href="Create-material.html" class="nav-link"><i class="fas fa-angle-right"></i>Create
                  Material</a>
              </li>
              <li class="nav-item" id="teacher-view">
                <a href="View-list-materials.html" class="nav-link"><i class="fas fa-angle-right"></i>List
                  Materials</a>
              </li>

            </ul>
          </li>
          <li class="nav-item sidebar-nav-item">
            <a href="#" class="nav-link"><i class="flaticon-chat"></i><span>Application</span></a>
            <ul class="nav sub-group-menu">
              <li class="nav-item">
                <a href="Send-application.html" class="nav-link"><i class="fas fa-angle-right"></i>Send
                  application</a>
              </li>

              <li class="nav-item">
                <a href="View-my-application.html" class="nav-link"><i class="fas fa-angle-right"></i>My
                  application</a>
              </li>
            </ul>
          </li>

<!--          <li class="nav-item sidebar-nav-item">-->
<!--            <a class="nav-link" href="#"><i class="flaticon-shopping-list"></i><span>Thread</span></a>-->
<!--            <ul class="nav sub-group-menu sub-group-active">-->
<!--              <li class="nav-item">-->
<!--                <a class="nav-link menu-active" href="forum.html"><i class="fas fa-angle-right"></i>View list-->
<!--                  threads</a>-->
<!--              </li>-->
<!--              <li class="nav-item">-->
<!--                <a class="nav-link" href="create-forum.html"><i class="fas fa-angle-right"></i>Create-->
<!--                  Thread</a>-->
<!--              </li>-->
<!--            </ul>-->
<!--          </li>-->
        </ul>
      </div>
    </div>
    <!-- Sidebar Area End Here -->
    <div id="deleteModal" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Delete Thread</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to delete this thread?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" id="confirmDelete" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </div>
    </div>
    <div class="dashboard-content-one container">
      <!-- Create Thread Button -->
      <a href="create-forum.html" class="modal-trigger" style="display: inline-block; padding: 10px 20px; text-align: center; background-color: #007bff; color: white; border-radius: 5px; text-decoration: none;">
        Create Thread
      </a>
      <!-- Thread List Start -->
      <div id="threadList" style="padding-top:20px "></div>
      <!-- Thread List End -->
      <!-- Pagination Controls -->
      <div class="pagination-controls text-center" style="margin-top: 20px; margin-bottom: 40px;">
        <!-- Previous Page Button -->
        <button class="page-btn" id="prevPage" disabled>&laquo;</button>
        <!-- Page Number Display -->
        <span id="pageNumber">1</span>
        <!-- Next Page Button -->
        <button class="page-btn" id="nextPage">&raquo;</button>
      </div>
    </div>
    <!-- Main Body Content End Here -->
  </div>
  <footer class="footer-wrap-layout1" style="width: 100%; padding: 0; margin: 0;">
    <div style="background-color: #ec9006; padding: 15px;">
      <div class="container">
        <div class="row">
          <div class="col-md-12 text-center">
            <p style="color: #ffffff;">© Copyright <a href="#" style="color: #ffcc00;">FPT</a> 2024. All
              rights reserved. Designed by <a href="#" style="color: #ffcc00;">HE170478</a></p>
          </div>
        </div>
      </div>
    </div>
  </footer>
</div>
<!-- Page Area End Here -->
<!-- jquery-->
<script src="js/jquery-3.3.1.min.js"></script>
<!-- Plugins js -->
<script src="js/plugins.js"></script>
<!-- Popper js -->
<script src="js/popper.min.js"></script>
<!-- Bootstrap js -->
<script src="js/bootstrap.min.js"></script>
<!-- Select 2 Js -->
<script src="js/select2.min.js"></script>
<!-- Scroll Up Js -->
<script src="js/jquery.scrollUp.min.js"></script>
<!-- Date Picker Js -->
<script src="js/datepicker.min.js"></script>
<!-- Data Table Js -->
<script src="js/jquery.dataTables.min.js"></script>
<!-- Custom Js -->
<script src="js/main.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize variables
    const userDetails = JSON.parse(sessionStorage.getItem('userDetails'));
    if (userDetails) {
      const userFullNameElements = document.querySelectorAll('.userFullName');
      const userRoleElements = document.querySelectorAll('.userRole');
      // Populate Name
      userFullNameElements.forEach(element => {
        element.textContent = userDetails.roleName === "ADMIN" ? userDetails.username : userDetails.fullName;
      });
      // Populate Role
      userRoleElements.forEach(element => {
        element.textContent = userDetails.roleName;
      });
      const imgContainers = document.querySelectorAll('.img'); // Select all parent divs with class 'img'
      imgContainers.forEach(container => {
        const imgElement = container.querySelector('img'); // Select the <img> inside the div
        if (imgElement) {
          imgElement.src = userDetails.img || 'default-passport.jpg'; // Set the src of the <img>
        }
      });
      // Update Dashboard link based on role
      // const dashboardLink = document.getElementById('dashboardLink');
      // if (userDetails.roleName === 'TEACHER') {
      //   dashboardLink.href = 'teacher.html';  // Change the link to 'teacher.html' for teachers
      // }
    }
    const currentUserId = userDetails.id;
    const prevPageButton = document.getElementById("prevPage");
    const nextPageButton = document.getElementById("nextPage");
    const pageNumber = document.getElementById("pageNumber");
    const threadList = document.getElementById("threadList");
    const threadsPerPage = 8;
    let currentPage = 1; // Start on the first page
    let totalPages = 1; // Set a default number of pages (this will be updated after fetching all threads)
    let allThreads = []; // This will hold all threads
    let threadToDeleteId = null;
    // Function to fetch all threads (without pagination)
    function fetchAllThreads() {
      fetch(`/thread/threads?page=0&size=10000`)  // Large enough size to fetch all threads
              .then(response => response.json())
              .then(data => {
                if (data.content && Array.isArray(data.content) && data.content.length > 0) {
                  // Sort all threads by dateCreated in descending order (newest first)
                  allThreads = data.content.sort((a, b) => new Date(b.dateCreated) - new Date(a.dateCreated));
                  totalPages = Math.ceil(allThreads.length / threadsPerPage); // Calculate total pages
                  fetchThreads(currentPage); // Fetch the first page of sorted threads
                } else {
                  threadList.innerHTML = "<p>No threads available.</p>";
                }
              })
              .catch(error => {
                console.error("Error fetching threads:", error);
                alert("Error fetching threads");
              });
    }
    // Function to fetch and render threads for the current page
    function fetchThreads(page) {
      const startIndex = (page - 1) * threadsPerPage;
      const pageThreads = allThreads.slice(startIndex, startIndex + threadsPerPage); // Get threads for the current page
      if (pageThreads.length > 0) {
        renderThreads(pageThreads); // Render the threads on the page
        pageNumber.textContent = currentPage; // Update the page number display
        updatePagination(); // Update pagination buttons' state
      }
    }
    // Function to render threads on the page
    function renderThreads(threads) {
      threadList.innerHTML = ""; // Clear existing threads
      threads.forEach(thread => {
        const threadBox = document.createElement("div");
        threadBox.className = "thread-box";
        threadBox.setAttribute("data-thread-id", thread.id);
        const formattedDate = new Date(thread.dateCreated).toLocaleDateString();
        // Add thread content and the dropdown for actions (Edit/Delete)
        threadBox.innerHTML = `
        <div class="thread-thumbnail">
            <img src="data:image/png;base64,${thread.image || 'N/A'}" alt="Thread Image">
        </div>
        <div class="thread-content">
            <div class="card height-auto">
                <div class="heading-layout1">
                    <div class="item-title d-flex justify-content-between align-items-center">
                        <div class="thread-title">
                            <a href="post.html?id=${thread.id}">${thread.topicName}</a>
                        </div>
                        <div class="spacer"></div>
                        <div class="dropdown">
                        ${thread.creatorId === currentUserId ? `
                            <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-expanded="false">...</a>
                            <div class="dropdown-menu dropdown-menu-right">
                                <!-- Show Update and Delete options only for the thread creator -->
                                    <a class="dropdown-item edit-thread" href="/edit-forum.html?threadId=${thread.id}">
                                        <i class="fas fa-cogs text-dark-pastel-green"></i> Edit
                                    </a>
                                    <a class="dropdown-item delete-thread" href="#" data-thread-id="${thread.id}">
                                        <i class="fas fa-times text-orange-red"></i> Delete
                                    </a>
                                ` : ""}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="thread-description">${thread.description}</div>
                <div class="thread-date">Created on: ${formattedDate}</div>
            </div>
        </div>`;
        threadList.appendChild(threadBox);
      });
    }
    // Function to update pagination button states
    function updatePagination() {
      if (currentPage === 1) {
        prevPageButton.disabled = true; // Disable previous button on the first page
      } else {
        prevPageButton.disabled = false;
      }
      if (currentPage === totalPages) {
        nextPageButton.disabled = true; // Disable next button on the last page
      } else {
        nextPageButton.disabled = false;
      }
    }
    // Set up event listeners for pagination buttons
    if (prevPageButton && nextPageButton) {
      prevPageButton.addEventListener('click', function () {
        if (currentPage > 1) {
          currentPage--; // Decrement the current page
          fetchThreads(currentPage); // Fetch the new page
        }
      });
      nextPageButton.addEventListener('click', function () {
        if (currentPage < totalPages) {
          currentPage++; // Increment the current page
          fetchThreads(currentPage); // Fetch the new page
        }
      });
    }
    // Function to delete the thread
    function deleteThread(threadId) {
      fetch(`http://localhost:8080/thread/delete/${threadId}`, {
        method: 'DELETE',
        headers: {
          'Authorization': 'Bearer ' + sessionStorage.getItem('jwtToken') // Include JWT if needed
        }
      })
              .then(response => {
                if (response.ok) {
                  alert('Thread deleted successfully');
                  fetchAllThreads(); // Refresh the thread list after deletion
                } else {
                  alert('Failed to delete thread');
                }
              })
              .catch(error => {
                console.error('Error:', error);
                alert('Error deleting thread');
              });
    }
    // Open the custom delete modal when clicking on "Delete"
    document.addEventListener("click", function (event) {
      if (event.target && event.target.matches("a.delete-thread")) {
        threadToDeleteId = event.target.getAttribute("data-thread-id");
        // Show the custom delete confirmation modal
        $('#deleteModal').modal('show');
      }
    });
    // Confirm delete modal
    document.getElementById('confirmDelete').addEventListener('click', function () {
      if (threadToDeleteId !== null) {
        deleteThread(threadToDeleteId);
        // Close the modal after the delete action
        $('#deleteModal').modal('hide');
      }
    });
    // Function to refresh the threads after editing
    function refreshAfterEdit() {
      fetchAllThreads(); // Refresh the thread list after editing
    }
    // Check if the current page is the thread edit page and add a listener for refresh after edit
    if (window.location.pathname.includes("edit-forum.html")) {
      // Add listener to refresh after thread edit
      window.addEventListener("load", function() {
        const submitButton = document.getElementById("submitEdit");
        if (submitButton) {
          submitButton.addEventListener("click", function() {
            refreshAfterEdit(); // Refresh after editing
          });
        }
      });
    }
    // Initial fetch of all threads and render them sorted
    fetchAllThreads();
  });
</script>
<script>
  function submitForm() {
    // Retrieve userDetails from sessionStorage
    const userDetails = JSON.parse(sessionStorage.getItem('userDetails'));
    if (userDetails && userDetails.teacherId) {
      // Redirect to the appropriate URL with the teacherId
      window.location.href = `class-list-teacher.html?teacherId=${userDetails.teacherId}`;
    } else {
      console.error("Teacher ID is missing or user details not found in sessionStorage");
    }
  }
  function toListAssigment() {
    // Retrieve userDetails from sessionStorage
    const userDetails = JSON.parse(sessionStorage.getItem('userDetails'));
    if (userDetails && userDetails.teacherId) {
      // Redirect to the appropriate URL with the teacherId
      window.location.href = `list-assignment.html?teacherId=${userDetails.teacherId}`;
    } else {
      console.error("Teacher ID is missing or user details not found in sessionStorage");
    }
  }
  function redirectSchedule() {
    // Retrieve userDetails from sessionStorage
    const userDetails = JSON.parse(sessionStorage.getItem('userDetails'));
    if (userDetails && userDetails.teacherId) {
      // Redirect to the appropriate URL with the teacherId
      window.location.href = `schedule-list-teacher.html?teacherId=${userDetails.teacherId}`;
    } else {
      console.error("Teacher ID is missing or user details not found in sessionStorage");
    }
  }
</script>
<!-- fetch notification headbar-->
<script>
  window.onload = function() {
    const notificationCount = document.getElementById('notification-count'); // Số lượng thông báo
    const notificationBell = document.getElementById('notification-bell'); // Biểu tượng chuông thông báo

    // Kiểm tra trạng thái khi trang được tải lại hoặc khi chuyển sang trang mới
    const hasSeenNotifications = localStorage.getItem('hasSeenNotifications');
    if (hasSeenNotifications === 'true') {
      notificationCount.style.display = 'none'; // Nếu đã xem thông báo, ẩn số lượng
    }
  };

  // Fetch notifications từ server
  fetch('/notification/getAll')
          .then(response => response.json()) // Parse dữ liệu JSON
          .then(data => {
            const notificationList = document.getElementById('notification-list'); // Container danh sách thông báo
            const notificationCount = document.getElementById('notification-count'); // Số lượng thông báo
            const notificationBell = document.getElementById('notification-bell'); // Biểu tượng chuông

            // Kiểm tra dữ liệu nhận được
            console.log(data);

            // Giả sử tất cả thông báo là chưa đọc (isRead = false) nếu không có trường này
            data.forEach(notification => {
              if (!notification.hasOwnProperty('isRead')) {
                notification.isRead = false; // Thêm trường isRead nếu không có
              }
            });

            // Lọc các thông báo chưa đọc (isRead === false)
            const unreadNotifications = data.filter(notification => notification.isRead === false);

            // Cập nhật số lượng thông báo chưa đọc
            notificationCount.textContent = unreadNotifications.length;

            // Hiển thị số lượng thông báo nếu có thông báo chưa đọc, nếu không thì ẩn
            notificationCount.style.display = unreadNotifications.length > 0 ? 'inline' : 'none';

            // Nếu không có thông báo, hiển thị thông báo trống
            if (data.length === 0) {
              notificationList.innerHTML = '<p>No notifications available.</p>';
              return;
            }

            // Clear các thông báo cũ
            notificationList.innerHTML = '';

            // Sắp xếp thông báo theo thời gian (mới nhất trước)
            data.sort((a, b) => {
              const dateA = new Date(a.createdAt || a.created || Date.now());
              const dateB = new Date(b.createdAt || b.created || Date.now());
              return dateB - dateA; // Sắp xếp giảm dần (mới nhất trước)
            });

            // Giới hạn hiển thị 7 thông báo mới nhất
            const notificationsToDisplay = data.slice(0, 7);

            // Thêm từng thông báo vào danh sách
            notificationsToDisplay.forEach(notification => {
              const noticeDiv = document.createElement('div');
              noticeDiv.classList.add('notice-list');

              const noticeTitle = document.createElement('h6');
              noticeTitle.classList.add('notice-title');

              // Set tiêu đề với nội dung HTML (bao gồm thẻ <a>)
              noticeTitle.innerHTML = notification.title;

              // Kiểm tra nếu tiêu đề có chứa các thẻ <a> (link)
              const links = noticeTitle.getElementsByTagName('a');

              // Nếu có bất kỳ thẻ <a> nào trong tiêu đề, style chúng
              for (let link of links) {
                link.style.color = 'blue';  // Màu xanh cho các link
                link.style.textDecoration = 'underline';  // Gạch chân các link
              }

              // Thêm tiêu đề vào phần tử thông báo
              noticeDiv.appendChild(noticeTitle);

              // Thêm thông báo vào danh sách
              notificationList.appendChild(noticeDiv);
            });

            // Ẩn số lượng thông báo khi người dùng bấm chuông
            notificationBell.addEventListener('click', () => {
              notificationCount.style.display = 'none'; // Ẩn số lượng thông báo khi bấm chuông
              // Lưu trạng thái "đã xem thông báo" vào localStorage
              localStorage.setItem('hasSeenNotifications', 'true');

              // Đánh dấu tất cả thông báo là đã đọc (isRead = true)
              data.forEach(notification => notification.isRead = true);

              // Lưu lại trạng thái thông báo đã đọc vào localStorage (tùy vào yêu cầu của bạn)
              localStorage.setItem('notifications', JSON.stringify(data));
            });
          })
          .catch(error => {
            console.error('Error fetching notifications:', error);
            document.getElementById('notification-list').innerHTML = '<p>Failed to load notifications.</p>';
          });

</script>
</body>
</html>